<main>
    <section class="search-section">
        <div class="mdc-card search-card">
            <div class="search-form">
                <%= erb :'partials/_search_field', locals: { 
                    field: 'actor1', 
                    label: 'First Actor', 
                    suggestion_id: '1'
                } %>
                
                <%= erb :'partials/_search_field', locals: { 
                    field: 'actor2', 
                    label: 'Second Actor', 
                    suggestion_id: '2'
                } %>
                
                <!-- Keep hidden fields outside containers to ensure they persist -->
                <input type="hidden" id="actor1_id_backup" name="actor1_id_backup">
                <input type="hidden" id="actor2_id_backup" name="actor2_id_backup">
                <input type="hidden" id="actor1_name_backup" name="actor1_name_backup">
                <input type="hidden" id="actor2_name_backup" name="actor2_name_backup">
            </div>
            
            <div class="compare-button-container">
                <button class="mdc-button mdc-button--raised" 
                        id="compareBtn"
                        data-mdc-auto-init="MDCRipple"
                        hx-get="/api/actors/compare"
                        hx-target="#timeline"
                        hx-vals='js:{
                            "actor1_id": document.getElementById("actor1_id_backup").value, 
                            "actor2_id": document.getElementById("actor2_id_backup").value, 
                            "actor1_name": document.getElementById("actor1_name_backup").value, 
                            "actor2_name": document.getElementById("actor2_name_backup").value
                        }'
                        hx-indicator="#timeline"
                        onclick="trackComparison();">
                    <span class="mdc-button__ripple"></span>
                    <span class="mdc-button__label">Explore Filmographies Together</span>
                </button>
            </div>
        </div>
    </section>

    <section class="results-section" id="results">
        <div class="mdc-card results-card">
            <div class="timeline-container" id="timeline">
                <!-- Timeline content or loading state will be inserted here -->
            </div>
        </div>
    </section>
    
    <!-- MDC FAB for scroll to top -->
    <button class="mdc-fab mdc-fab--mini" id="scrollToTop" data-mdc-auto-init="MDCRipple">
        <div class="mdc-fab__ripple"></div>
        <span class="mdc-fab__icon material-icons">keyboard_arrow_up</span>
    </button>
    
    <!-- MDC Snackbar for notifications -->
    <div class="mdc-snackbar" id="snackbar" data-mdc-auto-init="MDCSnackbar">
        <div class="mdc-snackbar__surface" role="status" aria-relevant="additions">
            <div class="mdc-snackbar__label" id="snackbarMessage" aria-atomic="false"></div>
            <div class="mdc-snackbar__actions" aria-atomic="true">
                <button type="button" class="mdc-button mdc-snackbar__action" id="snackbarAction" data-mdc-auto-init="MDCRipple">
                    <div class="mdc-button__ripple"></div>
                    <span class="mdc-button__label">UNDO</span>
                </button>
            </div>
        </div>
    </div>
</main>

<% if @actor1_id && @actor2_id %>
<script>
// Pre-populate backup fields immediately
document.getElementById('actor1_id_backup').value = '<%= @actor1_id %>';
document.getElementById('actor2_id_backup').value = '<%= @actor2_id %>';
<% if @actor1_name %>
document.getElementById('actor1_name_backup').value = '<%= @actor1_name.gsub("'", "\\'") %>';
<% end %>
<% if @actor2_name %>
document.getElementById('actor2_name_backup').value = '<%= @actor2_name.gsub("'", "\\'") %>';
<% end %>

// Auto-trigger comparison when actor IDs are provided
document.addEventListener('DOMContentLoaded', function() {
    // Wait for actorSearch to be available and show pills
    const showPillsAndCompare = function() {
        if (!window.actorSearch) {
            setTimeout(showPillsAndCompare, 10);
            return;
        }
        
        // Show pills for selected actors
        <% if @actor1_name && @actor1_id %>
        window.actorSearch.selectActor('<%= @actor1_id %>', '<%= @actor1_name.gsub("'", "\\'") %>', 'actor1');
        <% end %>
        
        <% if @actor2_name && @actor2_id %>
        window.actorSearch.selectActor('<%= @actor2_id %>', '<%= @actor2_name.gsub("'", "\\'") %>', 'actor2');
        <% end %>
        
        // Trigger comparison immediately using requestAnimationFrame to ensure DOM updates
        requestAnimationFrame(function() {
            const compareBtn = document.getElementById('compareBtn');
            if (compareBtn) {
                compareBtn.click();
            }
        });
    };
    
    // Start immediately
    showPillsAndCompare();
});
</script>
<% end %>

