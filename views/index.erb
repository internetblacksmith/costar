<main>
    <section class="intro-section">
        <div class="intro-content">
            <p class="intro-text">
                <span style="color: var(--magenta); text-shadow: 0 0 3px #ff00aa44;">&gt;</span> Search for two actors you remember from a scene, and discover all the movies they've appeared in together.
            </p>
        </div>
    </section>

    <section class="search-section">
        <div class="search-card">
            <div class="panel-header">
                Query Interface
                <span class="header-line"></span>
            </div>

            <div class="search-form">
                <%= erb :'partials/_search_field', locals: { 
                    field: 'actor1', 
                    label: 'First Actor', 
                    suggestion_id: '1'
                } %>
                
                <%= erb :'partials/_search_field', locals: { 
                    field: 'actor2', 
                    label: 'Second Actor', 
                    suggestion_id: '2'
                } %>
                
                <!-- Keep hidden fields outside containers to ensure they persist -->
                <input type="hidden" id="actor1_id_backup" name="actor1_id_backup">
                <input type="hidden" id="actor2_id_backup" name="actor2_id_backup">
                <input type="hidden" id="actor1_name_backup" name="actor1_name_backup">
                <input type="hidden" id="actor2_name_backup" name="actor2_name_backup">
            </div>
            
            <div class="compare-button-container">
                <button class="btn btn--primary" 
                        id="compareBtn"
                        hx-get="/api/actors/compare"
                        hx-target="#timeline"
                        hx-cache="false"
                        hx-vals='js:{
                            "actor1_id": document.getElementById("actor1_id_backup").value, 
                            "actor2_id": document.getElementById("actor2_id_backup").value, 
                            "actor1_name": document.getElementById("actor1_name_backup").value, 
                            "actor2_name": document.getElementById("actor2_name_backup").value
                        }'
                        hx-indicator="#timeline"
                        onclick="trackComparison();">
                    <span class="btn__label">Find Common Movies</span>
                </button>
            </div>
        </div>
    </section>

    <section class="results-section" id="results">
        <div class="results-card">
            <div class="results-label">
                Output Stream
                <span class="header-line"></span>
            </div>
            <div class="timeline-container" id="timeline">
                <!-- Timeline content or loading state will be inserted here -->
            </div>
        </div>
    </section>
    
    <!-- Scroll to top button -->
    <button class="scroll-to-top-btn" id="scrollToTop">
        <span class="material-icons">keyboard_arrow_up</span>
    </button>
    
    <!-- Toast notification -->
    <div class="toast" id="snackbar">
        <div class="toast__surface" role="status" aria-relevant="additions">
            <div class="toast__label" id="snackbarMessage" aria-atomic="false"></div>
            <div class="toast__actions" aria-atomic="true">
                <button type="button" class="btn btn--text toast__action" id="snackbarAction">
                    <span class="btn__label">UNDO</span>
                </button>
            </div>
        </div>
    </div>
</main>

<% if @actor1_id && @actor2_id %>
<script>
// Pre-populate backup fields immediately
document.getElementById('actor1_id_backup').value = '<%= @actor1_id %>';
document.getElementById('actor2_id_backup').value = '<%= @actor2_id %>';
<% if @actor1_name %>
document.getElementById('actor1_name_backup').value = '<%= @actor1_name.gsub("'", "\\'") %>';
<% end %>
<% if @actor2_name %>
document.getElementById('actor2_name_backup').value = '<%= @actor2_name.gsub("'", "\\'") %>';
<% end %>

// Auto-trigger comparison when actor IDs are provided
document.addEventListener('DOMContentLoaded', function() {
    // Wait for actorSearch to be available and show pills
    const showPillsAndCompare = function() {
        if (!window.actorSearch) {
            setTimeout(showPillsAndCompare, 10);
            return;
        }
        
        // Show pills for selected actors
        <% if @actor1_name && @actor1_id %>
        window.actorSearch.selectActor('<%= @actor1_id %>', '<%= @actor1_name.gsub("'", "\\'") %>', 'actor1');
        <% end %>
        
        <% if @actor2_name && @actor2_id %>
        window.actorSearch.selectActor('<%= @actor2_id %>', '<%= @actor2_name.gsub("'", "\\'") %>', 'actor2');
        <% end %>
        
        // Trigger comparison immediately using requestAnimationFrame to ensure DOM updates
        requestAnimationFrame(function() {
            const compareBtn = document.getElementById('compareBtn');
            if (compareBtn) {
                compareBtn.click();
            }
        });
    };
    
    // Start immediately
    showPillsAndCompare();
});
</script>
<% end %>
