<main>
    <section class="search-section">
        <div class="mdc-card search-card">
            <div class="search-form">
                <%= erb :'partials/_search_field', locals: { 
                    field: 'actor1', 
                    label: 'First Actor', 
                    suggestion_id: '1' 
                } %>
                
                <%= erb :'partials/_search_field', locals: { 
                    field: 'actor2', 
                    label: 'Second Actor', 
                    suggestion_id: '2' 
                } %>
            </div>
            
            <div class="compare-button-container">
                <button class="mdc-button mdc-button--raised" 
                        id="compareBtn"
                        data-mdc-auto-init="MDCRipple"
                        hx-get="/api/actors/compare"
                        hx-target="#timeline"
                        hx-include="#actor1_id, #actor2_id, #actor1_name, #actor2_name"
                        hx-vals='js:{"actor1_id": document.getElementById("actor1_id").value, "actor2_id": document.getElementById("actor2_id").value}'
                        hx-indicator="#timeline"
                        onclick="trackComparison();">
                    <span class="mdc-button__ripple"></span>
                    <span class="mdc-button__label">Explore Filmographies Together</span>
                </button>
            </div>
        </div>
    </section>

    <section class="results-section" id="results">
        <div class="mdc-card results-card">
            <div class="timeline-container" id="timeline">
                <!-- Timeline content or loading state will be inserted here -->
            </div>
        </div>
    </section>
    
    <!-- MDC FAB for scroll to top -->
    <button class="mdc-fab mdc-fab--mini" id="scrollToTop" data-mdc-auto-init="MDCRipple">
        <div class="mdc-fab__ripple"></div>
        <span class="mdc-fab__icon material-icons">keyboard_arrow_up</span>
    </button>
    
    <!-- MDC Snackbar for notifications -->
    <div class="mdc-snackbar" id="snackbar" data-mdc-auto-init="MDCSnackbar">
        <div class="mdc-snackbar__surface" role="status" aria-relevant="additions">
            <div class="mdc-snackbar__label" id="snackbarMessage" aria-atomic="false"></div>
            <div class="mdc-snackbar__actions" aria-atomic="true">
                <button type="button" class="mdc-button mdc-snackbar__action" id="snackbarAction" data-mdc-auto-init="MDCRipple">
                    <div class="mdc-button__ripple"></div>
                    <span class="mdc-button__label">UNDO</span>
                </button>
            </div>
        </div>
    </div>
</main>

<% if @actor1_id && @actor2_id %>
<script>
// Auto-trigger comparison when actor IDs are provided
document.addEventListener('DOMContentLoaded', function() {
    // Set the actor IDs in hidden fields
    document.getElementById('actor1_id').value = '<%= @actor1_id %>';
    document.getElementById('actor2_id').value = '<%= @actor2_id %>';
    
    // Trigger the compare button click
    const compareBtn = document.getElementById('compareBtn');
    if (compareBtn) {
        // Small delay to ensure HTMX is initialized
        setTimeout(function() {
            compareBtn.click();
        }, 100);
    }
    
    // Optionally fetch and display actor names
    fetchActorName('<%= @actor1_id %>', 'actor1');
    fetchActorName('<%= @actor2_id %>', 'actor2');
});

function fetchActorName(actorId, field) {
    fetch(`/api/actors/${actorId}/movies`)
        .then(response => response.json())
        .then(data => {
            if (data.actor_name) {
                // Set the hidden name field
                const nameField = document.getElementById(`${field}_name`);
                if (nameField) {
                    nameField.value = data.actor_name;
                }
                
                // Set the visible search input
                const searchInput = document.getElementById(field);
                if (searchInput) {
                    searchInput.value = data.actor_name;
                    // Trigger MDC text field to float the label
                    const textField = searchInput.closest('.mdc-text-field');
                    if (textField) {
                        textField.classList.add('mdc-text-field--label-floating');
                        // If MDC is initialized, update it
                        if (window.mdc && textField.MDCTextField) {
                            textField.MDCTextField.value = data.actor_name;
                        }
                    }
                }
            }
        })
        .catch(err => console.error('Error fetching actor name:', err));
}
</script>
<% end %>

