<div class="timeline">
    <!-- Share Button -->
    <div class="share-button-container">
        <button class="mdc-button mdc-button--raised share-button" onclick="shareTimeline()">
            <span class="mdc-button__ripple"></span>
            <span class="material-icons mdc-button__icon">share</span>
            <span class="mdc-button__label">Share Timeline</span>
        </button>
    </div>
    
    <!-- Actor Portrait Header -->
    <div class="actor-portrait-header" style="display: flex !important; flex-direction: row !important; align-items: center !important;">
        <div class="actor-portrait-left" style="flex: 1 !important;">
            <%= erb :'partials/_actor_portrait', locals: { 
                actor_name: @actor1_name, 
                actor_profile: @actor1_profile 
            } %>
        </div>
        <div class="actor-portrait-center" style="flex: 0 0 auto !important;">
            <div class="connection-indicator">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M8 3L4 7L8 11"></path>
                    <path d="M16 3L20 7L16 11"></path>
                    <line x1="4" y1="7" x2="20" y2="7"></line>
                </svg>
                <span class="connection-text">explore together</span>
            </div>
        </div>
        <div class="actor-portrait-right" style="flex: 1 !important;">
            <%= erb :'partials/_actor_portrait', locals: { 
                actor_name: @actor2_name, 
                actor_profile: @actor2_profile 
            } %>
        </div>
    </div>
    
    <% @years.each do |year| %>
        <% next unless @processed_movies[year] %>
        
        <% shared_movies_this_year = @shared_movies.select { |m| m[:year] == year } %>
        
        <div class="year-group">
            <%= erb :'partials/_year_header', locals: { 
                year: year, 
                shared_movies_count: shared_movies_this_year.length 
            } %>
            
            <div class="movies-timeline">
                <% @processed_movies[year].each do |entry| %>
                    <% if entry[:type] == :shared %>
                        <!-- Shared movie on same line -->
                        <div class="movie-row shared-movie-row">
                            <div class="movie-left">
                                <% left_movie = entry[:movies].find { |m| m[:side] == :left } %>
                                <% if left_movie %>
                                    <% mobile_actors_info = [
                                        "#{left_movie[:actor]}: #{left_movie[:movie][:character] || 'Unknown'}",
                                        "#{entry[:movies].find { |m| m[:side] == :right }&.dig(:actor) || ''}: #{entry[:movies].find { |m| m[:side] == :right }&.dig(:movie, :character) || 'Unknown'}"
                                    ].compact %>
                                    
                                    <%= erb :'partials/_movie_card', locals: { 
                                        movie: left_movie[:movie], 
                                        actor_name: left_movie[:actor], 
                                        shared: true,
                                        mobile_actors_info: mobile_actors_info
                                    } %>
                                <% else %>
                                    <div class="movie-placeholder"></div>
                                <% end %>
                            </div>
                            
                            <div class="movie-center">
                                <div class="shared-movie-indicator">
                                    <span class="material-icons">movie</span>
                                </div>
                            </div>
                            
                            <div class="movie-right">
                                <% right_movie = entry[:movies].find { |m| m[:side] == :right } %>
                                <% if right_movie %>
                                    <%= erb :'partials/_movie_card', locals: { 
                                        movie: right_movie[:movie], 
                                        actor_name: right_movie[:actor], 
                                        shared: true,
                                        mobile_actors_info: nil
                                    } %>
                                <% else %>
                                    <div class="movie-placeholder"></div>
                                <% end %>
                            </div>
                        </div>
                    <% else %>
                        <!-- Single movie on its own line -->
                        <div class="movie-row single-movie-row">
                            <% if entry[:movie][:side] == :left %>
                                <div class="movie-left">
                                    <%= erb :'partials/_movie_card', locals: { 
                                        movie: entry[:movie][:movie], 
                                        actor_name: entry[:movie][:actor], 
                                        shared: false,
                                        mobile_actors_info: nil
                                    } %>
                                </div>
                                <div class="movie-center"></div>
                                <div class="movie-right">
                                    <div class="movie-placeholder"></div>
                                </div>
                            <% else %>
                                <div class="movie-left">
                                    <div class="movie-placeholder"></div>
                                </div>
                                <div class="movie-center"></div>
                                <div class="movie-right">
                                    <%= erb :'partials/_movie_card', locals: { 
                                        movie: entry[:movie][:movie], 
                                        actor_name: entry[:movie][:actor], 
                                        shared: false,
                                        mobile_actors_info: nil
                                    } %>
                                </div>
                            <% end %>
                        </div>
                    <% end %>
                <% end %>
            </div>
        </div>
    <% end %>
</div>

<script>
function shareTimeline() {
    // Get actor IDs from template variables
    const actor1Id = '<%= @actor1_id %>';
    const actor2Id = '<%= @actor2_id %>';
    
    // Build the shareable URL
    const shareUrl = `${window.location.origin}/?actor1_id=${actor1Id}&actor2_id=${actor2Id}`;
    
    // Copy to clipboard
    navigator.clipboard.writeText(shareUrl).then(() => {
        // Show success message using Material Design snackbar
        const snackbar = document.createElement('div');
        snackbar.className = 'mdc-snackbar mdc-snackbar--open';
        snackbar.innerHTML = `
            <div class="mdc-snackbar__surface">
                <div class="mdc-snackbar__label">Timeline link copied to clipboard!</div>
            </div>
        `;
        document.body.appendChild(snackbar);
        
        // Remove snackbar after 3 seconds
        setTimeout(() => {
            snackbar.remove();
        }, 3000);
    }).catch(err => {
        // Fallback for older browsers
        const tempInput = document.createElement('input');
        tempInput.value = shareUrl;
        document.body.appendChild(tempInput);
        tempInput.select();
        document.execCommand('copy');
        document.body.removeChild(tempInput);
        
        // Show success message
        alert('Timeline link copied to clipboard!');
    });
}
</script>